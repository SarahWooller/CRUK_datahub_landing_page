import{R as W,f as y,j as e,a as ee,H as se}from"./Header-BhufHUp4.js";const v=new Map,T=(s,t)=>{if(!s)return;(Array.isArray(s)?s:Object.values(s)).forEach(a=>{const l=a.id;v.set(l,{id:a.id,label:a.label,category:a.category,group:t}),a.children&&Object.keys(a.children).length>0&&T(a.children,t)})};T(y["0_0"].children,y["0_0"].primaryGroup);T(y["0_2"].children,y["0_2"].primaryGroup);T(y["0_1"].children,y["0_1"].primaryGroup);const H=(s,t,r,a,l)=>{const d=s.filter(p=>t(p)==="hist"),i=s.filter(p=>t(p)==="top"||t(p)==="cruk"),c=s.filter(p=>t(p)==="data"),o=s.filter(p=>t(p)==="access"),n=[],x=r(d),m=l(x,"OR");m&&n.push(m);const I=r(i),b=l(I,"OR");b&&n.push(b);const w=c.map(p=>{const M=a(p).filter(P=>v.has(P));return l(M,"OR")}).filter(Boolean).join(" AND ");w&&n.push(w);const R=l(o,"OR");return R&&n.push(R),n.join(" AND ")},{useState:j,useMemo:D,useCallback:S,useEffect:V}=W,N=({items:s,handleFilterChange:t,selectedFilters:r,level:a=0})=>{if(!s||s.length===0)return null;const l=Array.isArray(s)?s:Object.values(s);return e.jsx("div",{className:"nested-list space-y-1",children:l.map(d=>e.jsx(te,{item:d,handleFilterChange:t,selectedFilters:r,level:a},d.id))})},te=({item:s,handleFilterChange:t,selectedFilters:r,level:a})=>{const l=s.id,d=s.children?Object.values(s.children):[],i=d.length>0,c=r.has(l),[o,n]=j(!1),x=_=>{_.preventDefault(),n(w=>!w)},m={paddingLeft:a>0?`${a*1.25}rem`:"0"},b=(v.get(l)||{}).group;return e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center group hover:var(--cruk-pink) p-1 -m-1 rounded transition duration-100",style:m,children:[i?e.jsx("button",{type:"button",className:`transition-transform duration-200 w-4 h-4 flex items-center justify-center text-gray-500 hover:var(--cruk-pink)  mr-1 ${o?"rotate-90":""}`,onClick:x,"aria-expanded":o,children:e.jsx("svg",{className:"w-3 h-3 transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})}):e.jsx("span",{className:"w-4 h-4 mr-1"}),e.jsx("input",{type:"checkbox",id:l,className:"rounded text-[var(--cruk-pink)] border-gray-300 focus:ring-[var(--cruk-pink)] mr-2 w-4 h-4 cursor-pointer","data-filter-group":b,checked:c,onChange:()=>t(l)}),e.jsxs("label",{htmlFor:l,className:"text-gray-700 select-none flex-grow cursor-pointer text-sm",children:[s.label,e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",s.count,")"]})]})]}),i&&o&&e.jsx(N,{items:d,handleFilterChange:t,selectedFilters:r,level:a+1})]})},K=s=>{const t=s.split("_");if(t.length<3)return"unknown";const r=t[1];if(r==="2")return"data";if(r==="1")return"access";{const a=t[2];return a==="1"?"hist":a==="0"?"top":a==="2"?"cruk":"unknown"}},L=s=>{if(s){const t=s.split("_");if(t[1]!=="1"&&t.length>3){const r=[];for(let a=4;a<=t.length;a++)r.push(t.slice(0,a).join("_"));return r}}return[s]},U=s=>{if(!s||s.length===0)return[];const t=new Set;return s.forEach(r=>{L(r).forEach(a=>{t.add(a)})}),Array.from(t).filter(r=>v.has(r))},q=(s,t)=>{const r=s.length;return r===0?"":r===1?v.get(s[0])?.label||"":`(${s.map(l=>v.get(l)?.label).filter(Boolean).join(` ${t} `)})`},$=({selectedFilters:s,logicMessage:t,setLogicMessage:r,isMessageManuallyEdited:a,setIsMessageManuallyEdited:l})=>{const d=S(o=>{r(o.target.value),l(!0)},[r,l]),i=S(()=>{const o=Array.from(s),n=H(o,K,U,L,q);r(n),l(!1)},[s,r,l]);if(!s||s.size===0)return null;const c=a;return e.jsxs("div",{className:"p-1 mt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("p",{className:"text-sm text-gray-700 font-semibold",children:"Filter Logic: once you have chosen your filters you can adjust the logic below."}),c&&e.jsx("button",{type:"button",onClick:i,className:"text-xs text-blue-600 hover:text-blue-800 transition duration-150 font-medium py-1 px-2 rounded border border-blue-300 hover:bg-blue-50",children:"Reset to Auto Logic"})]}),e.jsx("textarea",{id:"logic-summary-message",className:"w-full text-xs text-gray-800 bg-gray-50 p-2 rounded break-words font-mono border border-gray-300 resize-y focus:ring-[var(--cruk-pink)] focus:border-[var(--cruk-pink)]",value:t||"No filters selected",onChange:d,rows:Math.max(2,Math.ceil((t||"No filters selected").length/100))}),a&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"Note: Filter logic has been manually edited. If you need to add filters reset logic first"})]})};$.utilityFunctions={filterType:K,plusParents:U,includeParents:L,getMessage:q};const re=({selectedFilters:s,handleFilterChange:t,logicMessage:r,setLogicMessage:a,isMessageManuallyEdited:l,setIsMessageManuallyEdited:d})=>{const i=D(()=>Array.from(s).map(o=>{const n=v.get(o);if(!n)return null;const m=n.group==="cancer-type"?"bg-[var(--cruk-white)] text-[var(--cruk-pink)] border border-[var(--cruk-pink)]":"bg-[var(--cruk-white)] text-[var(--cruk-blue)] border border-[var(--cruk-blue)]";return{fullId:o,label:n.label,category:n.category,chipClass:m}}).filter(Boolean),[s]);return i.length===0?null:e.jsxs("div",{id:"selected-filters-area",className:"bg-white rounded-b-xl shadow-lg border-b border-l border-r border-gray-300 p-3 transition duration-300 ease-in-out",children:[e.jsx("div",{id:"filter-chip-list",className:"flex items-start flex-wrap gap-2 text-sm",children:i.map(c=>e.jsxs("div",{className:`filter-chip inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold shadow-sm ${c.chipClass}`,children:[e.jsxs("span",{className:"mr-1 opacity-75",children:[c.category,":"]}),e.jsx("span",{className:"font-bold",children:c.label}),e.jsx("button",{type:"button",className:"ml-2 h-4 w-4 rounded-full flex items-center justify-center hover:bg-white hover:bg-opacity-50 transition duration-150",onClick:()=>t(c.fullId),"aria-label":`Remove filter ${c.label}`,children:e.jsx("svg",{className:"w-3 h-3 fill-current",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},c.fullId))}),e.jsx($,{selectedFilters:s,logicMessage:r,setLogicMessage:a,isMessageManuallyEdited:l,setIsMessageManuallyEdited:d})]})},ae=()=>{const[s,t]=j(null),[r,a]=j(new Set),[l,d]=j(""),[i,c]=j(!1),[o,n]=j(""),[x,m]=j(null),[I,b]=j(!1),_=D(()=>Array.from(v.values()),[]),{filterType:w,plusParents:R,includeParents:p,getMessage:M}=$.utilityFunctions;V(()=>{if(!i){const u=Array.from(r),f=H(u,w,R,p,M);d(f)}},[r,i,w,R,p,M]),V(()=>{if(!o||o.length<4){m(null),b(!1);return}const u=setTimeout(()=>{b(!0);const h={cancer:"cancer-type",data:"data-type",access:"access"}[s];if(!h){m(null),b(!1);return}const O=o.toLowerCase(),g=_.filter(A=>A.group!==h?!1:A.label.toLowerCase().includes(O)),C=new Set(g.map(A=>A.id));m(C),b(!1)},300);return()=>clearTimeout(u)},[o,s,_]);const P=S((u,f)=>{if(!u)return null;if(!f)return u;const h={};return(Array.isArray(u)?u:Object.values(u)).forEach(g=>{const C=P(g.children,f),A=f.has(g.id),Z=C&&Object.keys(C).length>0;if(A||Z){const G={...g};C&&(G.children=C),h[g.id]=G}}),Object.keys(h).length>0?h:null},[]),k=D(()=>{let u=0,f=0,h=0;return r.forEach(O=>{const g=v.get(O);g&&(g.group==="cancer-type"?u++:g.group==="data-type"?f++:g.group==="access"&&h++)}),{total:r.size,cancer:u,data:f,access:h}},[r]),z=S(u=>{a(f=>{const h=new Set(f);return h.has(u)?h.delete(u):h.add(u),h})},[]),Q=S(()=>{a(new Set),t(null),n(""),d(""),c(!1)},[]),X=S(()=>{console.log(`Executing search with ${k.total} filters. Current logic message: ${l}`),t(null)},[k.total,l]),Y=()=>{const u={handleFilterChange:z,selectedFilters:r,searchTerm:o,setSearchTerm:n,filteredIds:x,isSearching:I,pruneHierarchy:P};switch(s){case"cancer":return e.jsx(le,{...u});case"data":return e.jsx(ne,{...u});case"access":return e.jsx(ce,{...u});default:return null}},B=u=>`nav-button w-full px-4 py-3 text-left text-lg font-medium border-l-4 transition duration-150 ${s===u?"bg-gray-100 text-[var(--cruk-pink)] border-[var(--cruk-pink)]":"text-gray-600 hover:bg-gray-50 border-transparent"}`,F=k.total===0;return e.jsx("div",{className:"p-2 sm:p-8 bg-gray-50",children:e.jsx("div",{id:"filter-container",className:"w-full flex flex-col",children:e.jsxs("div",{className:"flex flex-col md:flex-row bg-white rounded-xl shadow-lg border border-gray-300 overflow-hidden",children:[e.jsxs("div",{id:"filter-navbar",className:"flex flex-col flex-shrink-0 w-full md:w-1/4 bg-gray-50 border-b md:border-b-0 md:border-r border-gray-200",children:[e.jsx("h2",{className:"p-4 text-3xl sm:text-4xl font-bold text-[var(--cruk-blue)]",children:"Study Filters"}),e.jsxs("button",{onClick:()=>{t("cancer"),n("")},className:B("cancer"),children:["Cancer Type ",e.jsxs("span",{className:"text-sm opacity-80 font-normal ml-2",children:["(",k.cancer," Selected)"]})]}),e.jsxs("button",{onClick:()=>{t("data"),n("")},className:B("data"),children:["Data Type ",e.jsxs("span",{className:"text-sm opacity-80 font-normal ml-2",children:["(",k.data," Selected)"]})]}),e.jsxs("button",{onClick:()=>{t("access"),n("")},className:B("access"),children:["Accessibility ",e.jsxs("span",{className:"text-sm opacity-80 font-normal ml-2",children:["(",k.access," Selected)"]})]}),e.jsx("button",{onClick:Q,className:"px-4 py-2 font-medium text-sm text-gray-500 hover:var(--cruk-pink) hover:text-[var(--cruk-pink)] transition duration-150 bg-white rounded-lg shadow-sm border border-gray-300",children:"Clear Filters"}),e.jsxs("button",{onClick:X,className:`bg-[var(--cruk-pink)] text-white font-bold py-3 px-8 rounded-lg shadow-md transition duration-150 ${F?"opacity-50 cursor-not-allowed":"hover:opacity-90"}`,disabled:F,children:["Find Studies (",k.total,")"]})]}),e.jsxs("div",{className:"flex-grow w-full md:w-3/4 p-0",children:[e.jsx(re,{selectedFilters:r,handleFilterChange:z,logicMessage:l,setLogicMessage:d,isMessageManuallyEdited:i,setIsMessageManuallyEdited:c}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:s&&Y()})]})]})})})},E=({searchTerm:s,setSearchTerm:t,isSearching:r,placeholder:a})=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"search",placeholder:a||"Search terms (min 4 characters)...",className:"w-full px-4 py-2 pl-10 border border-gray-300 rounded-lg focus:ring-[var(--cruk-pink)] focus:border-[var(--cruk-pink)] text-sm",value:s,onChange:l=>t(l.target.value)}),e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:r?e.jsxs("svg",{className:"animate-spin h-5 w-5 text-[var(--cruk-pink)]",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})})})]}),s&&s.length<4&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Please enter at least 4 characters to search."})]}),le=({handleFilterChange:s,selectedFilters:t,searchTerm:r,setSearchTerm:a,filteredIds:l,isSearching:d,pruneHierarchy:i})=>{const c=y["0_0"].children,o=i(c["0_0_0"].children,l),n=i(c["0_0_1"].children,l),x=i(c["0_0_2"].children,l);return e.jsx("div",{id:"cancer-type-panel",className:"md:col-span-3 bg-white rounded-xl overflow-hidden flex flex-col",children:e.jsxs("div",{className:"p-3 sm:p-4 text-gray-600 flex-grow overflow-hidden",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-3",children:"Cancer Type Selection"}),e.jsx(E,{searchTerm:r,setSearchTerm:a,isSearching:d,placeholder:"Search Cancer/ICD-O terms"}),e.jsx("p",{className:"text-sm italic text-gray-500 mb-3",children:"Filter by official pathology classifications (ICD-O) or patient-friendly CRUK terminology."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 border p-3 rounded-lg bg-gray-100",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-800 mb-3 border-b pb-1",children:"ICD-O Classification"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-3 rounded-md shadow-inner border border-gray-200",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-700 mb-2",children:"Topography"}),e.jsx("div",{id:"icdo-topography-list",className:"h-40 overflow-y-auto space-y-1 text-sm pr-2",children:e.jsx(N,{items:o,handleFilterChange:s,selectedFilters:t})})]}),e.jsxs("div",{className:"bg-white p-3 rounded-md shadow-inner border border-gray-200",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-700 mb-2",children:"Histology"}),e.jsx("div",{id:"icdo-histology-list",className:"h-40 overflow-y-auto space-y-1 text-sm pr-2",children:e.jsx(N,{items:n,handleFilterChange:s,selectedFilters:t})})]})]})]}),e.jsxs("div",{className:"border p-3 rounded-lg bg-gray-50",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-800 mb-3 border-b pb-1",children:"CRUK Cancer Terms"}),e.jsx("div",{id:"cruk-terms-list",className:"h-40 overflow-y-auto space-y-1 text-sm pr-2",children:e.jsx(N,{items:x,handleFilterChange:s,selectedFilters:t})})]})]})]})})},ne=({handleFilterChange:s,selectedFilters:t,searchTerm:r,setSearchTerm:a,filteredIds:l,isSearching:d,pruneHierarchy:i})=>{const c=y["0_2"].children,o=i(c["0_2_0"].children,l),n=i(c["0_2_1"].children,l),x=i(c["0_2_2"].children,l),m=i(c["0_2_3"].children,l);return e.jsx("div",{id:"data-type-panel",className:"md:col-span-3 bg-white rounded-xl overflow-hidden flex flex-col",children:e.jsxs("div",{className:"p-3 sm:p-4 text-gray-600 flex-grow overflow-hidden",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-3",children:"Data Type Selection"}),e.jsx(E,{searchTerm:r,setSearchTerm:a,isSearching:d,placeholder:"Search data types"}),e.jsx("p",{className:"text-sm italic text-gray-500 mb-2",children:"Select one or more modalities to include in your search."}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"border p-3 rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-700 mb-2 border-b pb-1",children:"Biobank Samples"}),e.jsx("div",{id:"biobank-samples-list",className:"h-40 overflow-y-auto space-y-1 text-sm pr-2",children:e.jsx(N,{items:o,handleFilterChange:s,selectedFilters:t})})]}),e.jsxs("div",{className:"border p-3 rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-700 mb-2 border-b pb-1",children:"In Vitro Studies"}),e.jsx("div",{id:"invitro-studies-list",className:"h-40 overflow-y-auto space-y-1 text-sm pr-2",children:e.jsx(N,{items:n,handleFilterChange:s,selectedFilters:t})})]}),e.jsxs("div",{className:"border p-3 rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-700 mb-2 border-b pb-1",children:"Animal Studies"}),e.jsx("div",{id:"animal-studies-list",className:"h-40 overflow-y-auto space-y-1 text-sm pr-2",children:e.jsx(N,{items:x,handleFilterChange:s,selectedFilters:t})})]}),e.jsxs("div",{className:"border p-3 rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-700 mb-2 border-b pb-1",children:"Patient Studies"}),e.jsx("div",{id:"patient-studies-list",className:"h-40 overflow-y-auto space-y-1 text-sm pr-2",children:e.jsx(N,{items:m,handleFilterChange:s,selectedFilters:t})})]})]})]})})},ce=({handleFilterChange:s,selectedFilters:t,searchTerm:r,setSearchTerm:a,filteredIds:l,isSearching:d,pruneHierarchy:i})=>{const c=Object.values(y["0_1"].children),o=D(()=>l?c.filter(n=>l.has(n.id)):c,[c,l]);return e.jsx("div",{id:"accessibility-panel",className:"md:col-span-3 bg-white rounded-xl overflow-hidden flex flex-col",children:e.jsxs("div",{className:"p-3 sm:p-4 text-gray-600 flex-grow overflow-hidden",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-3",children:"Accessibility and Source"}),e.jsx(E,{searchTerm:r,setSearchTerm:a,isSearching:d,placeholder:"Search accessibility/source terms"}),e.jsx("p",{className:"text-sm italic text-gray-500 mb-2",children:"Filter by data access level and source."}),e.jsx("div",{className:"h-32 overflow-y-auto pr-2 border p-3 rounded-lg",children:e.jsxs("div",{className:"space-y-2",children:[o.map(n=>{const x=n.id,m=t.has(x);return e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:x,className:"rounded text-[var(--cruk-pink)] border-gray-300 focus:ring-[var(--cruk-pink)] mr-2 w-4 h-4 cursor-pointer","data-filter-group":"access",checked:m,onChange:()=>s(x)}),e.jsxs("label",{htmlFor:x,className:"text-gray-700 select-none flex-grow cursor-pointer text-sm",children:[n.label," ",e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",n.count,")"]})]})]},n.id)}),d===!1&&r.length>=4&&o.length===0&&e.jsxs("p",{className:"text-sm text-gray-500",children:['No results found for "',r,'".']})]})})]})})};function J(s,t){const r=document.getElementById(s);r?ee.createRoot(r).render(e.jsx(W.StrictMode,{children:t})):console.error(`Target element '${s}' not found in the DOM. Cannot render component.`)}J("header",e.jsx(se,{}));J("vert_navbar",e.jsx(ae,{}));
